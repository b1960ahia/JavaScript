<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Loterias Caixa â€” LotofÃ¡cil & Lotomania</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    .container { max-width: 1200px; margin: 0 auto; }
    .filters { background: #f5f5f5; padding: 15px; margin-bottom: 20px; border-radius: 5px; }
    .stats { display: grid; grid-template-columns: repeat(auto-fill, minmax(60px,1fr)); gap: 10px; margin: 20px 0; }
    .stat-item { background: #e3f2fd; padding: 10px; text-align: center; border-radius: 5px; font-size:12px; }
    .stat-item-destaque { background: #ff9800 !important; color:#fff; font-weight:bold; }
    table { width: 100%; border-collapse: collapse; margin-top: 20px; }
    th, td { border: 1px solid #ddd; padding: 8px; text-align: center; }
    th { background: #2196f3; color: white; }
    .dezenas { display: flex; flex-wrap:wrap; gap: 2px; justify-content: center; }
    .dezena { background: #2196f3; color: white; width: 25px; height: 25px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 12px; }
    .dezena-destaque { background: #ff9800 !important; color: #fff !important; font-weight: bold; }
    canvas { margin-top: 30px; }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
<div class="container">
  <h1>ðŸ“Š LotofÃ¡cil â€” Dados Oficiais</h1>
  <div class="filters">
    <label>Concurso Inicial: <input type="number" id="lfInicio"></label>
    <label>Concurso Final: <input type="number" id="lfFim"></label>
    <button onclick="carregar('lotofacil')">Atualizar</button>
    <label style="margin-left:20px;">Destacar dezenas (vÃ­rgula):
      <input type="text" id="lfDestacar" placeholder="Ex: 3,5,10" style="width:120px;">
    </label>
    <button onclick="atualizarDestaque('lotofacil')">Aplicar</button>
  </div>
  <div id="lfEstatisticas"></div>
  <canvas id="lfGrafico" height="120"></canvas>
  <div id="lfResultados"></div>

  <hr style="margin:40px 0;">

  <h1>ðŸ“Š Lotomania â€” Dados Oficiais</h1>
  <div class="filters">
    <label>Concurso Inicial: <input type="number" id="lmInicio"></label>
    <label>Concurso Final: <input type="number" id="lmFim"></label>
    <button onclick="carregar('lotomania')">Atualizar</button>
    <label style="margin-left:20px;">Destacar dezenas (vÃ­rgula):
      <input type="text" id="lmDestacar" placeholder="Ex: 3,5,10" style="width:120px;">
    </label>
    <button onclick="atualizarDestaque('lotomania')">Aplicar</button>
  </div>
  <div id="lmEstatisticas"></div>
  <canvas id="lmGrafico" height="120"></canvas>
  <div id="lmResultados"></div>
</div>

<script>
let charts = {};
let dezenasDestaque = { lotofacil: [], lotomania: [] };
let cache = { lotofacil: null, lotomania: null };

async function fetchConcurso(tipo, numero) {
  const url = `https://servicebus2.caixa.gov.br/portaldeloterias/api/${tipo}/${numero}`;
  const resp = await fetch(url,{
    headers: {
      "Accept": "application/json, text/plain, */*",
      "Origin": "https://loterias.caixa.gov.br",
      "Referer": "https://loterias.caixa.gov.br/",
    }
  });
  if (!resp.ok) throw new Error(`Erro ao buscar concurso ${numero} (${tipo}): ${resp.status}`);
  return resp.json();
}

async function fetchUltimo(tipo) {
  const url = `https://servicebus2.caixa.gov.br/portaldeloterias/api/${tipo}`;
  const resp = await fetch(url,{
    headers: {
      "Accept": "application/json, text/plain, */*",
      "Origin": "https://loterias.caixa.gov.br",
      "Referer": "https://loterias.caixa.gov.br/",
    }
  });
  if (!resp.ok) throw new Error(`Erro ao buscar Ãºltimo concurso ${tipo}: ${resp.status}`);
  return resp.json();
}

async function carregar(tipo) {
  try {
    const iniInput = document.getElementById(tipo === 'lotofacil' ? 'lfInicio':'lmInicio').value;
    const fimInput = document.getElementById(tipo === 'lotofacil' ? 'lfFim':'lmFim').value;
    let inicio = parseInt(iniInput);
    let fim = parseInt(fimInput);

    if (!inicio || !fim) {
      const ultimo = await fetchUltimo(tipo);
      fim = ultimo.numero;
      inicio = fim - 20;
      document.getElementById(tipo==='lotofacil'?'lfFim':'lmFim').value=fim;
      document.getElementById(tipo==='lotofacil'?'lfInicio':'lmInicio').value=inicio;
    }

    if (inicio>fim){alert("Concurso inicial nÃ£o pode ser maior que final.");return;}

    const resultados=[];
    for(let n=inicio;n<=fim;n++){
      try {
        const d=await fetchConcurso(tipo,n);
        resultados.push(d);
      }catch(e){console.warn("Falha no concurso:",n,e);}
    }

    const sorteios=resultados.filter(Boolean).map(d=>({
      concurso:d.numero,
      data:d.dataApuracao,
      dezenas:d.listaDezenas.map(x=>parseInt(x,10)).sort((a,b)=>a-b)
    }));

    const maxDezena = tipo==='lotofacil'?25:100;
    const stats=calcularEstatisticas(sorteios,maxDezena);

    cache[tipo] = { stats, sorteios };
    exibir(tipo,stats,sorteios);

  }catch(e){
    console.error("Erro ao carregar dados:",e);
    alert("NÃ£o foi possÃ­vel buscar os dados oficiais. Verifique console.");
  }
}

function calcularEstatisticas(dados,max){
  const stats=Array(max).fill(0);
  dados.forEach(s=>{
    s.dezenas.forEach(d=>{
      if (max===25){
        stats[d-1]++;
      } else {
        stats[d]++;
      }
    });
  });
  return stats;
}

function exibir(tipo,stats,sorteios){
  const destaques = dezenasDestaque[tipo];

  // estatÃ­sticas
  let html=`<h2>ðŸ“ˆ FrequÃªncia das Dezenas</h2><div class="stats">`;
  stats.forEach((c,i)=>{
    const val = tipo==='lotofacil'? (i+1):i;
    const numero = tipo==='lotofacil'
      ? (i+1).toString()
      : i.toString().padStart(2,'0');
    const classe = destaques.includes(val)?'stat-item stat-item-destaque':'stat-item';
    html+=`<div class="${classe}">
      <div style="font-size:14px;font-weight:bold;">${numero}</div>
      <div>${c} vez${c!==1?'es':''}</div>
    </div>`;
  });
  html+=`</div>`;
  document.getElementById(tipo==='lotofacil'?'lfEstatisticas':'lmEstatisticas').innerHTML=html;

  // resultado oficial
  let html2=`<h2>ðŸŽ¯ Resultados Oficiais</h2>
    <table><tr><th>Concurso</th><th>Data</th><th>Dezenas</th></tr>`;
  sorteios.forEach(s=>{
    html2+=`<tr><td>${s.concurso}</td><td>${s.data}</td><td><div class="dezenas">${
      s.dezenas.map(d=>{
        const num = tipo==='lotofacil'
          ? d.toString()
          : d.toString().padStart(2,'0');
        const classe = (destaques.includes(d))
            ? 'dezena dezena-destaque'
            : 'dezena';
        return `<div class="${classe}">${num}</div>`;
      }).join('')
    }</div></td></tr>`;
  });
  html2+=`</table>`;
  document.getElementById(tipo==='lotofacil'?'lfResultados':'lmResultados').innerHTML=html2;

  // grÃ¡fico
  const ctx=document.getElementById(tipo==='lotofacil'?'lfGrafico':'lmGrafico').getContext('2d');
  const labels=stats.map((_,i)=>
    tipo==='lotofacil'
      ? (i+1).toString()
      : i.toString().padStart(2,'0')
  );

  // cores dinÃ¢micas
  const backgroundColors = stats.map((_,i)=>{
    const val = tipo==='lotofacil'? (i+1):i;
    return destaques.includes(val)?'#ff9800':'#2196f3';
  });

  if(charts[tipo]) charts[tipo].destroy();

  charts[tipo]=new Chart(ctx,{
    type:'bar',
    data:{
      labels,
      datasets:[{
        label:'FrequÃªncia',
        data:stats,
        backgroundColor:backgroundColors
      }]
    },
    options:{
      responsive:true,
      scales:{
        y:{beginAtZero:true,title:{display:true,text:'Quantidade'}},
        x:{title:{display:true,text:'Dezena'}}
      }
    }
  });
}

function atualizarDestaque(tipo){
  const val = document.getElementById(tipo==='lotofacil'?'lfDestacar':'lmDestacar').value;
  if (val.trim()==='') {
    dezenasDestaque[tipo]=[];
  } else {
    dezenasDestaque[tipo]=val.split(',')
      .map(x=>parseInt(x.trim(),10))
      .filter(x=>!isNaN(x));
  }
  if (cache[tipo]) exibir(tipo, cache[tipo].stats, cache[tipo].sorteios);
}

window.addEventListener('load',()=>{
  carregar('lotofacil');
  carregar('lotomania');
});
</script>
</body>
</html>

